#!/bin/sh

set -o pipefail -x

export AWS_ACCESS_KEY_ID={{ aws.access_key_id }}
export AWS_SECRET_ACCESS_KEY={{ aws.secret_access_key }}
export AWS_REGION=us-west-2

ENVIRONMENT=dev
BUCKET={{ homewatch_agent.bucket }}
TRIM_PREFIX={{ homewatch_agent.trim_prefix }}
WATCH_PATHS={{ homewatch_agent.watch_paths }}

# Exposes Prometheus metrics endpoint on default port
/app/homewatch \
        --v2 \
        --v2-enable-metrics \
        --v2-watch-paths $WATCH_PATHS \
        --v2-enable-watch-reaper \
        --v2-enable-upload-reaper \
        --enable-video-upload \
        --s3-video-bucket-url="s3://$BUCKET/$ENVIRONMENT/{{ homewatch_agent.bucket_prefix }}" \
        --video-trim-prefix="$TRIM_PREFIX"
